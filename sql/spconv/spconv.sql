SELECT A1.A_EDGE, SUM(A2.A_VAL * B_VAL)
FROM A AS A1 INNER JOIN A AS A2 ON ABS(A1.A_CRD0 - A2.A_CRD0) <= 1 AND ABS(A1.A_CRD1 - A2.A_CRD1) <= 1
       INNER JOIN B ON B_CRD0 = A1.A_CRD0 - A2.A_CRD0 + 1 AND B_CRD1 = A1.A_CRD1 - A2.A_CRD1 + 1
GROUP BY A1.A_EDGE;
